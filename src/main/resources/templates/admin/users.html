<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin | Manage Users</title>
  <link rel="stylesheet" th:href="@{/style.css}" />
  <style>
    .status-badge {
      display: inline-block;
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }
    .status-active { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-deactivated { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
    .status-banned { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  </style>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<section class="about">
  <div class="container">
    <h1>User Management</h1>
    <p>Manage user accounts — deactivate, reactivate, or ban members.</p>

    <div th:if="${error}" class="message error-message" style="text-align: left; margin-top: 1rem;">
        <span th:text="${error}"></span>
    </div>
    <div th:if="${success}" class="message success-message" style="text-align: left; margin-top: 1rem;">
        <span th:text="${success}"></span>
    </div>
  </div>
</section>

<section class="events">
  <div class="container">

    <div th:if="${#lists.isEmpty(users)}" style="text-align:center; margin-top:2rem;">
      <p>No users found for this status.</p>
    </div>

    <div class="event-grid" th:if="${!#lists.isEmpty(users)}">
      <div class="event-card-browse" th:each="user : ${users}">
        <h3 th:text="${user.email}">user@example.com</h3>
        <p><strong>ID:</strong> <span th:text="${user.user_id()}">1</span></p>
        <p><strong>Created:</strong>
          <span th:text="${#temporals.format(user.created_at(), 'dd MMM yyyy HH:mm')}">2025-01-01</span>
        </p>

        <p>
          <strong>Status:</strong>
          <span th:switch="${user.status}">
            <span th:case="'ACTIVE'" class="status-badge status-active">Active</span>
            <span th:case="'DEACTIVATED'" class="status-badge status-deactivated">Deactivated</span>
            <span th:case="'BANNED'" class="status-badge status-banned">Banned</span>
            <span th:case="*"
                  class="status-badge"
                  style="background:#e2e3e5; color:#383d41;">Unknown</span>
          </span>
        </p>

        <div class="back-links">

          <form th:action="@{'/admin/users/' + ${user.user_id()}}" method="get" style="display:inline;">
            <button type="submit" class="back-btn secondary">View</button>
          </form>

          <form th:if="${user.status == 'ACTIVE'}"
                th:action="@{'/admin/users/' + ${user.user_id()} + '/deactivate'}"
                method="post" style="display:inline;">
            <button type="submit" class="back-btn secondary">Deactivate</button>
          </form>

          <form th:if="${user.status == 'DEACTIVATED'}"
                th:action="@{'/admin/users/' + ${user.user_id()} + '/reactivate'}"
                method="post" style="display:inline;">
            <button type="submit" class="back-btn" style="background:#28a745; border-color:#28a745;">Reactivate</button>
          </form>

          <form th:if="${user.status != 'BANNED'}"
                th:action="@{'/admin/users/' + ${user.user_id()} + '/ban'}"
                method="post" style="display:inline;">
            <button type="submit" class="back-btn" style="background:#dc3545; border-color:#dc3545;">Ban</button>
          </form>

          <span th:if="${user.status == 'BANNED'}"
                style="color:#dc3545; font-weight:bold; margin-left:8px;">
            Banned User
          </span>

        </div>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="footer-bottom">
    <p>© 2025 EventHub Admin Console</p>
  </div>
</footer>

<div th:replace="~{fragments/notification :: notification-script}"></div>
</body>
</html>